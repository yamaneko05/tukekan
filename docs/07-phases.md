# 7. 開発フェーズ

## フェーズ設計の考え方

```
Phase 1-1: 基盤構築
    ↓ 全ての土台。これがないと何も作れない
Phase 1-2: 認証機能
    ↓ ユーザー識別がないとデータを誰のものか区別できない
Phase 1-3: コア機能
    ↓ アプリの主目的。最小限の価値を提供
Phase 1-4: MVP完成
    ↓ コア機能を補完し、実用レベルに
Phase 2: 機能拡張
    ↓ MVPで十分使える状態になってから
Phase 3: グループ機能
      最も複雑。既存機能が安定してから
```

**ポイント**: 各フェーズ終了時点で「動くもの」ができる。Phase 1-3終了時点で最低限使えるアプリになる。

---

## Phase 1-1: 基盤構築

- [ ] プロジェクトセットアップ（Next.js 16 + TypeScript + Tailwind）
- [ ] Prismaスキーマ定義・マイグレーション
- [ ] shadcn/ui導入
- [ ] 基本レイアウト（ヘッダー、ボトムバー、FAB）

---

## Phase 1-2: 認証機能

- [ ] ログイン Server Action（JWT発行、Cookie設定）
- [ ] ログアウト Server Action
- [ ] セッション取得ユーティリティ
- [ ] ログイン画面UI（ユーザー選択式）
- [ ] 初期ユーザー作成（prisma/seed.ts）

※ 新規登録画面は Phase 3 で実装
※ ログイン画面のユーザー名入力は、MVP期間中はセレクトボックスによる選択式。Phase 3のグループ機能実装時にテキスト入力に変更する。

---

## Phase 1-3: コア機能（自分の貸借管理）

- [ ] Partner作成 Server Action
- [ ] Transaction作成 Server Action
- [ ] ホーム画面（残高タブ）Server Component
- [ ] 取引登録モーダル
- [ ] 取引履歴画面

---

## Phase 1-4: MVP完成

- [ ] ホーム画面（履歴タブ）
- [ ] メンバー一覧画面
- [ ] 他ユーザーダッシュボード画面
- [ ] 設定画面
- [ ] 説明サジェスト機能

---

## Phase 2: 機能拡張

- [ ] 全額精算機能
- [ ] 取引タイプ（LEND/BORROW/REPAYMENT）追加
- [ ] 複数人での割り勘機能
- [ ] CSVエクスポート機能

---

## Phase 3: グループ機能・UX向上

### グループ機能
- [ ] Groupテーブル追加
- [ ] 新規登録機能（招待リンク経由）
- [ ] グループ作成・招待機能
- [ ] グループ内のみデータ閲覧制限

### UX向上
- [ ] 通知機能（PWA Push）
- [ ] グラフ表示

---

## グループ機能の設計方針

### 採用パターン: 1ユーザー1グループ

グループごとにユーザーを作成する方式を採用。

| パターン | メリット | デメリット |
|----------|----------|------------|
| ログイン時にグループ選択 | 複数グループ参加可能 | UI複雑、セッション管理が煩雑 |
| ログイン後に切り替え | 柔軟 | 状態管理複雑、誤操作リスク |
| **1ユーザー1グループ（採用）** | シンプル、実装が容易 | 複数グループ参加時は別アカウント必要 |

**採用理由:**
- 招待リンク経由での登録と相性が良い
- データ取得時のフィルタリングが不要（ユーザー=グループが確定）
- 認証・認可ロジックがシンプル

### 共有Partnerは不採用

複雑さを避けるため、Partnerは各ユーザーが個別に管理する。グループ内でPartnerを共有する機能は実装しない。

### データ設計の拡張

```prisma
// 将来追加するテーブル
model Group {
  id        String   @id @default(cuid())
  name      String
  inviteCode String  @unique  // 招待リンク用コード
  createdAt DateTime @default(now())

  accounts  Account[]
}

// 既存テーブルへの変更
model Account {
  // ... 既存フィールド
  groupId   String
  group     Group    @relation(fields: [groupId], references: [id])
}
```

### 今意識しておくこと

| 項目 | 現状の対応 |
|------|------------|
| データ取得のフィルタリング | 現状は全データ取得 → 将来 `groupId` でフィルタを追加できる構造に |
| 認証チェックの一元化 | `getSession()` を全Server Actionsで使用 → 将来グループ権限チェックを追加しやすい |
| Partner の所有者 | `ownerId` で個人所有のまま維持（共有Partnerは不採用） |
